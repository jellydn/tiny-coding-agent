{
	"project": "tiny-coding-agent",
	"branchName": "ralph/agents-subagents",
	"description": "Agents & Subagents System - Multi-agent architecture with plan/build/explore agents coordinated via shared state file",
	"userStories": [
		{
			"id": "US-001",
			"title": "Define state file schema and types",
			"description": "As a developer, I need TypeScript types for the agent state file schema.",
			"acceptanceCriteria": [
				"Create src/agents/types.ts with StateFile interface",
				"StateFile includes: metadata (agent, version, timestamp, parameters), phase, taskDescription, status, results, errors, artifacts",
				"Metadata includes: agentName (string), agentVersion (string), invocationTimestamp (ISO8601), parameters (Record<string, unknown>)",
				"Results includes: plan (string), build (object), exploration (object), optional",
				"Export types for use across agents",
				"Typecheck passes"
			],
			"priority": 1,
			"passes": true,
			"notes": ""
		},
		{
			"id": "US-002",
			"title": "Implement state file reader/writer with atomic writes",
			"description": "As a subagent, I need to safely read and write the shared state file.",
			"acceptanceCriteria": [
				"Create src/agents/state.ts with readStateFile(path: string) function",
				"Create writeStateFile(path: string, state: StateFile) function using atomic write (write-then-rename)",
				"Handle file locking to prevent concurrent corruption",
				"Return descriptive errors for missing/invalid state files",
				"Include file rotation logic: archive to .1, .2 when size > 10MB",
				"Unit tests in src/agents/state.test.ts",
				"Typecheck passes"
			],
			"priority": 2,
			"passes": true,
			"notes": ""
		},
		{
			"id": "US-003",
			"title": "Create CLI dispatcher (tiny-agent command)",
			"description": "As a user, I want to invoke agent phases from the command line.",
			"acceptanceCriteria": [
				"Add commands to main.tsx: plan, build, explore, run-plan-build, run-all",
				"Each command accepts task description as argument",
				"Support --state-file flag (default: .tiny-state.json)",
				"Support --verbose flag for detailed logging",
				"Dispatch to appropriate agent subprocess or function",
				"Exit with code 0 (success), 1 (failure), 2 (invalid args)",
				"Typecheck passes"
			],
			"priority": 3,
			"passes": true,
			"notes": ""
		},
		{
			"id": "US-004",
			"title": "Implement plan-agent core",
			"description": "As plan-agent, I need to analyze tasks and generate structured plans.",
			"acceptanceCriteria": [
				"Create src/agents/plan-agent.ts with planAgent(taskDescription, stateFile) function",
				"Read codebase using finder/grep to understand context",
				"Generate plan with numbered phases, dependencies, success criteria",
				"Output plan as structured markdown with sections: Phase 1, Phase 2, etc.",
				"Write plan to state file under results.plan",
				"Include --prd flag option to generate PRD alongside plan",
				"Ask for confirmation before major architectural decisions",
				"Unit tests in src/agents/plan-agent.test.ts",
				"Typecheck passes"
			],
			"priority": 4,
			"passes": true,
			"notes": ""
		},
		{
			"id": "US-005",
			"title": "Implement build-agent core with interactive confirmation",
			"description": "As build-agent, I need to execute plans and create/modify code with user confirmation.",
			"acceptanceCriteria": [
				"Create src/agents/build-agent.ts with buildAgent(plan, stateFile) function",
				"Execute plan steps sequentially, updating state file progress after each",
				"Ask for confirmation before: file creation, file deletion, refactors >50 lines, dependency changes",
				"If error occurs: log error, update state file, ask user to retry/skip/abort (exit code 4 if declined)",
				"Support --dry-run flag to preview changes without executing",
				"Respect .gitignore when creating artifacts",
				"Unit tests in src/agents/build-agent.test.ts",
				"Typecheck passes"
			],
			"priority": 5,
			"passes": true,
			"notes": ""
		},
		{
			"id": "US-006",
			"title": "Implement explore-agent (read-only analysis)",
			"description": "As explore-agent, I need to analyze code and generate insights without modifying.",
			"acceptanceCriteria": [
				"Create src/agents/explore-agent.ts with exploreAgent(taskDescription, stateFile) function",
				"Perform read-only codebase analysis: file structure, dependencies, patterns",
				"Generate report with findings, recommendations, code metrics",
				"Support --depth flag: shallow (files/structure) vs. deep (full analysis)",
				"Write findings to state file under results.exploration",
				"No write access; pure reporting only",
				"Unit tests in src/agents/explore-agent.test.ts",
				"Typecheck passes"
			],
			"priority": 6,
			"passes": true,
			"notes": ""
		},
		{
			"id": "US-007",
			"title": "Wire agent composition: run-plan-build workflow",
			"description": "As a user, I want to execute plan → build in sequence with context carried between phases.",
			"acceptanceCriteria": [
				"Implement tiny-agent run-plan-build [task] command",
				"Execute plan-agent, then build-agent with same state file",
				"If plan-agent fails (exit code 1), skip build-agent and exit",
				"User sees phase transitions in output (Phase 1/2 labels)",
				"Final state file contains results from both phases",
				"Typecheck passes"
			],
			"priority": 7,
			"passes": true,
			"notes": ""
		},
		{
			"id": "US-008",
			"title": "Wire agent composition: run-all workflow",
			"description": "As a user, I want to execute all three agents in sequence.",
			"acceptanceCriteria": [
				"Implement tiny-agent run-all [task] command",
				"Execute plan → build → explore in order",
				"Stop at first failure and prompt user before continuing",
				"All results accumulate in single state file",
				"Clear output showing phase completion status",
				"Typecheck passes"
			],
			"priority": 8,
			"passes": true,
			"notes": ""
		},
		{
			"id": "US-009",
			"title": "Add state inspection commands",
			"description": "As a user, I want to inspect the state file and agent logs.",
			"acceptanceCriteria": [
				"Implement tiny-agent state show [--state-file path] to print state file JSON",
				"Implement tiny-agent state clear [--state-file path] to reset state",
				"Pretty-print JSON output for readability",
				"Support --json flag for raw JSON",
				"Typecheck passes"
			],
			"priority": 9,
			"passes": true,
			"notes": ""
		},
		{
			"id": "US-010",
			"title": "Display current agent in chat UI status bar",
			"description": "As a user, I want to see which agent is currently active in the status bar.",
			"acceptanceCriteria": [
				"Add currentAgent field to UI state (default: 'default', options: 'default', 'plan', 'build', 'explore')",
				"Display current agent name in StatusBar component",
				"Update status when agent changes",
				"Style agent indicator distinctly (color-coded per agent type)",
				"Typecheck passes"
			],
			"priority": 10,
			"passes": true,
			"notes": ""
		},
		{
			"id": "US-011",
			"title": "Add agent switcher tab in chat UI",
			"description": "As a user, I want to switch between agents using tabs in the chat interface.",
			"acceptanceCriteria": [
				"Create AgentSwitcher component with tabs: Default, Plan, Build, Explore",
				"Display tabs above or below the input area",
				"Highlight currently selected agent tab",
				"Use arrow keys and Enter to navigate/select agents",
				"Switching agent updates currentAgent state and clears/preserves context as appropriate",
				"Typecheck passes"
			],
			"priority": 11,
			"passes": true,
			"notes": ""
		},
		{
			"id": "US-012",
			"title": "Add plan/tasks viewer CLI command",
			"description": "As a user, I want to view the current plan, tasks, and todos from the state file via CLI.",
			"acceptanceCriteria": [
				"Implement tiny-agent plan show [--state-file path] to display the current plan",
				"Implement tiny-agent tasks [--state-file path] to list all tasks with status (pending/done/failed)",
				"Implement tiny-agent todo [--state-file path] to show only pending tasks",
				"Format output with clear task numbering and status indicators",
				"Support --json flag for machine-readable output",
				"Show helpful message if no plan exists yet",
				"Typecheck passes"
			],
			"priority": 12,
			"passes": false,
			"notes": ""
		},
		{
			"id": "US-013",
			"title": "Add plan/tasks viewer in chat UI",
			"description": "As a user, I want to view plan, tasks, and todos within the chat interface using slash commands.",
			"acceptanceCriteria": [
				"Implement /plan command to display the current plan in chat",
				"Implement /tasks command to list all tasks with status indicators (✓ done, ○ pending, ✗ failed)",
				"Implement /todo command to show only pending tasks",
				"Display tasks in a formatted, readable box component",
				"Add commands to /help output",
				"Show helpful message if no plan exists yet",
				"Typecheck passes"
			],
			"priority": 13,
			"passes": false,
			"notes": ""
		}
	]
}
