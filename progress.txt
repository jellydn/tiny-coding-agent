## Codebase Patterns
- Use ANSI escape codes for terminal cursor positioning: `\x1b[s` (save), `\x1b[u` (restore), `\x1b[{row}H` (move to position)
- Hide cursor with `\x1b[?25l`, show with `\x1b[?25h`
- Clear line from cursor with `\x1b[K`
- StatusLine class should be a singleton exported via `getStatusLine()` helper
- Check `process.stdout.rows` to determine terminal bottom position
- Always gracefully degrade when `!process.stdout.isTTY` (non-TTY environments)

## 2026-01-20 07:13 - US-001
- Session: https://opncd.ai/s/3mkd4e
- Implemented StatusLine class in `src/cli/status-line.ts` with ANSI escape code rendering
- Exports: StatusLine class, getStatusLine() singleton, StatusDisplay and StatusLineOptions types
- Features: enable/disable, attach/detach, update(), clear(), format helpers for status/model/tokens/tool
- Updated `src/cli/index.ts` to export new status line components
- Typecheck: pass, Lint: pass, Test: pass (241 tests), Format: pass

**Learnings for future iterations:**
  - The codebase uses husky pre-commit hooks that run lint and format checks
  - CLI uses Ink (React) for main rendering but StatusLine uses raw ANSI for non-scrolling updates
  - Export types alongside classes from index files for consumers
  - Don't import unused modules (fs import was flagged by lint)
---

## 2026-01-20 07:45 - US-002
- Session: https://opncd.ai/s/2ab2f3
- Implemented color-coded status display in `src/ui/components/StatusLine.tsx`
- Added STATUS_LABELS and STATUS_COLORS maps for status styling
- Status values: '⏳ Thinking' (yellow), '✓ Ready' (green), '✗ Error' (red)
- Updated StatusLineProps to use typed status: "thinking" | "ready" | "error"
- Typecheck: pass, Lint: pass, Test: pass (241 tests), Format: pass

**Learnings for future iterations:**
  - Ink's Text component accepts color prop with string values like "yellow", "green", "red"
  - StatusDisplay type in cli/status-line.ts defines the canonical status values to use
  - Keep status types consistent between cli/status-line.ts and ui/components/StatusLine.tsx
---

## 2026-01-20 09:00 - US-004
- Session: https://opncd.ai/s/5mn6r3
- Updated StatusLine.tsx to accept tokensUsed and tokensMax props
- Added formatCompactNumber() helper for k-formatted numbers (e.g., 12.5k)
- Context display shows "Ctx: used/max" with gray/dim label color
- Typecheck: pass, Lint: pass, Test: pass (241 tests), Format: pass

**Learnings for future iterations:**
  - StatusLine.tsx uses separate props for tokensUsed/tokensMax instead of pre-formatted string
  - Compact formatting: >= 1000 uses `toFixed(1)` with 'k' suffix
  - Ink's Text color prop supports color names like "gray", "cyan", "yellow"
---

## 2026-01-20 10:30 - US-005
- Session: https://opncd.ai/s/7jk8l2
- Implemented timer in StatusLine.tsx using useState and useEffect
- Added toolStartTime prop instead of elapsed (tracks from tool start)
- Timer updates elapsed every 100ms while tool is active
- StatusLine shows "⚙ tool_name X.Xs" with cyan color
- Typecheck: pass, Lint: pass, Test: pass (241 tests), Format: pass

**Learnings for future iterations:**
  - Use useEffect with setInterval for real-time updates in Ink components
  - Store start timestamp (Date.now()) rather than passing elapsed to allow continuous updates
  - Clear interval on cleanup to prevent memory leaks
  - Props named toolStartTime are more accurate than elapsed for timer-based updates
---
