## Codebase Patterns
- Skills complement AGENTS.md - both can be active simultaneously
- Skill metadata parsing is lightweight for fast startup (only frontmatter parsed during discovery)
- Skills are filesystem-based with SKILL.md files in directories
- The yaml package is used for frontmatter parsing (already in dependencies)

## [Date/Time] - US-007
[Session: https://opncd.ai/s/ralph-session-001]
- Implemented `--skills-dir` CLI option to add custom skill directories
- Added `skillsDir?: string[]` to CliOptions interface
- Updated argument parsing to handle multiple `--skills-dir` flags
- Merged CLI-provided directories with config directories (CLI dirs appended after config dirs)
- Added help text for the new option
- Files changed: src/cli/main.tsx
- **Learnings for future iterations:**
  - When adding CLI options, need to update: interface, parseArgs(), help text, AND any functions that use the config
  - TypeScript strict mode requires null checks even after length checks
  - The pattern of merging CLI and config values works well: `options.x ? [...(config.x || []), ...options.x] : config.x`
  - There are two places where Agent is instantiated: handleRun and handleInteractiveChat - both need to be updated
---
## Sat Jan 25 2025 - US-012
[Session: https://opncd.ai/s/ralph-session-002]
- Added unit tests for allowed-tools frontmatter parsing in skill-tool.test.ts
- Added unit tests for agent tool filtering with skill restrictions in agent.test.ts
- Fixed parser to handle hyphenated YAML keys (allowed-tools vs allowedTools)
- Files changed: src/skills/parser.ts, src/tools/skill-tool.test.ts, src/core/agent.test.ts, scripts/ralph/prd.json
- **Learnings for future iterations:**
  - YAML keys with hyphens (e.g., `allowed-tools`) are parsed literally - need to handle both hyphenated and camelCase versions
  - TypeScript `ReturnType<typeof import(...)>` pattern is useful for testing private methods with complex return types
  - Agent's `_getToolDefinitions()` method already handles tool filtering based on `_activeSkillAllowedTools`
  - The skill tool's `onSkillLoaded` callback pattern integrates well with the agent's restriction system
---
